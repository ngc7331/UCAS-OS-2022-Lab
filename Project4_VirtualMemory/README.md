# Project 4

## 目录
- [Project 4](#project-4)
  - [目录](#目录)
  - [页目录](#页目录)
    - [页的回收](#页的回收)
    - [用户地址空间](#用户地址空间)

## 页目录
实地址空间
```
            ......
0x52004000 ---------------------------- <- FREEMEM_KERNEL
            内核栈（从）
0x52003000 ----------------------------
            内核栈（主）
0x52002000 ----------------------------
            内核运行栈（从）
0x52001000 ----------------------------
            内核运行栈（主）
0x52000000 ----------------------------
            ......
0x51002000 ----------------------------
            二级页表1 (启动页表)
0x51002000 ----------------------------
            二级页表0 (内核页表)
0x51001000 ----------------------------
            ......
0x51000808  一级页表[257] -> 内核页表
            ......
0x51000008  一级页表[1] -> 启动页表
            一级页表[0] -> NULL
0x51000000 ---------------------------- <- PGDIR_PA / SATP
```

### 页的回收
引用计数法

分配页 / 获取共享页时`ref++`

`do_exec()`和可用页框不足时进行`do_garbage_collector()`

尝试回收时`ref--`

### 用户地址空间
```
                ... (more thread stack)
0xf00020000 ---------------------------- <- USER_STACK_ADDR + PAGE_SIZE * 16
                 ↓  thread#0 stack
                ...
0xf00010000 ---------------------------- <- USER_STACK_ADDR
                 ↓  process stack
                ...
                 ↑  share pages
0x800000000 ---------------------------- <- SHM_PAGE_BASE
                ...
                 ↑  .text .bss .data
0x000010000 ---------------------------- <- USER_ENTRYPOINT
                ... (reserved)
0x000000000 ---------------------------- <- NULL
```
